FROM jboss/keycloak:11.0.2
#
# Keycloak version
#                    11.0.2
#
# Latest version: 16.1.0

USER root


ARG CEDAR_KEYCLOAK_ADMIN_USER
ENV CEDAR_KEYCLOAK_ADMIN_USER        ${CEDAR_KEYCLOAK_ADMIN_USER}
ARG CEDAR_KEYCLOAK_MYSQL_USER
ENV CEDAR_KEYCLOAK_MYSQL_USER        ${CEDAR_KEYCLOAK_MYSQL_USER}
ARG CEDAR_KEYCLOAK_MYSQL_PASSWORD
ENV CEDAR_KEYCLOAK_MYSQL_PASSWORD    ${CEDAR_KEYCLOAK_MYSQL_PASSWORD}
ARG CEDAR_KEYCLOAK_MYSQL_DB
ENV CEDAR_KEYCLOAK_MYSQL_DB          ${CEDAR_KEYCLOAK_MYSQL_DB}
ARG CEDAR_KEYCLOAK_MYSQL_HOST
ENV CEDAR_KEYCLOAK_MYSQL_HOST        ${CEDAR_KEYCLOAK_MYSQL_HOST}
ARG CEDAR_KEYCLOAK_MYSQL_PORT
ENV CEDAR_KEYCLOAK_MYSQL_PORT        ${CEDAR_KEYCLOAK_MYSQL_PORT}

ARG CEDAR_RESOURCE_ADMIN_PORT
ENV CEDAR_RESOURCE_ADMIN_PORT        ${CEDAR_RESOURCE_ADMIN_PORT}
ARG CEDAR_RESOURCE_HTTP_PORT
ENV CEDAR_RESOURCE_HTTP_PORT         ${CEDAR_RESOURCE_HTTP_PORT}
ARG CEDAR_RESOURCE_STOP_PORT
ENV CEDAR_RESOURCE_STOP_PORT         ${CEDAR_RESOURCE_STOP_PORT}
ARG CEDAR_ADMIN_USER_API_KEY
ENV CEDAR_ADMIN_USER_API_KEY         ${CEDAR_ADMIN_USER_API_KEY}
ARG CEDAR_KEYCLOAK_ADMIN_USER
ENV CEDAR_KEYCLOAK_ADMIN_USER        ${CEDAR_KEYCLOAK_ADMIN_USER}
ARG CEDAR_KEYCLOAK_ADMIN_PASSWORD
ENV CEDAR_KEYCLOAK_ADMIN_PASSWORD    ${CEDAR_KEYCLOAK_ADMIN_PASSWORD}

ARG CEDAR_KEYCLOAK_KEYSTORE_PASSWORD
ENV CEDAR_KEYCLOAK_KEYSTORE_PASSWORD ${CEDAR_KEYCLOAK_KEYSTORE_PASSWORD}


ARG KEYCLOAK_KEYSTORE
ENV KEYCLOAK_KEYSTORE             ${KEYCLOAK_KEYSTORE}


ARG CEDAR_NET_SUBNET
ENV CEDAR_NET_SUBNET              ${CEDAR_NET_SUBNET}
ARG CEDAR_NET_GATEWAY
ENV CEDAR_NET_GATEWAY             ${CEDAR_NET_GATEWAY}

ENV CEDAR_KEYCLOAK_HOME  /opt/jboss/keycloak

ENV CEDAR_VERSION=2.6.16

ENV KEYCLOAK_CONFIG_DIR /opt/jboss/keycloak/config
ADD config ${KEYCLOAK_CONFIG_DIR}

ENV JBOSS_STANDALONE_CONFIG ${CEDAR_KEYCLOAK_HOME}/standalone/configuration

ENV KEYCLOAK_SCRIPTS_DIR /opt/jboss/keycloak/scripts
ADD scripts ${KEYCLOAK_SCRIPTS_DIR}
RUN ${KEYCLOAK_SCRIPTS_DIR}/install.sh
RUN ${KEYCLOAK_SCRIPTS_DIR}/configure.sh

EXPOSE 8080
EXPOSE 8443

ENTRYPOINT ${KEYCLOAK_SCRIPTS_DIR}/docker-entrypoint.sh
